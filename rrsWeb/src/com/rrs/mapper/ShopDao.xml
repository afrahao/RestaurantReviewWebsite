<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rrs.mapper.ShopDao">


	<!-- 返回restaurant数量 -->
    <select id="getRestaurantNum" resultType="Integer">
        select count(*) from business
    </select>
    
	<!-- 返回一些restaurant -->
    <select id="getRestaurant" parameterType="Integer" resultType="com.rrs.pojo.Restaurant">
        select *,photo.id as img from business,photo where business.id=photo.business_id LIMIT #{0},#{1}
    </select>
    <!-- 返回restaurant By key -->
    <select id="getRestaurantSearch" parameterType="String" resultType="com.rrs.pojo.Restaurant">               
        select * from business where business.name like CONCAT('%',#{key},'%')      
    </select>
    
     <!-- 返回single By name -->
    <select id="getRestaurantImg" parameterType="String" resultType="String">               
        select photo.id as img from photo where photo.business_id=#{shop_id} LIMIT 0,1
    </select>
   
    <!-- 获取当前类别的餐馆 -->
    <select id="selectBusinessByCate" parameterType="int" resultType="com.rrs.pojo.Restaurant">
        select * from  business
        <where>
            id in select business_id from business_cate
            <where>
            	category_id = #{0}
            </where>
        </where>
    </select>
    
    <!-- 返回距离指定地点指定范围的restaurant -->
    <select id="getRestaurantByDistance1" resultType="com.rrs.pojo.Restaurant">
	    SELECT 
	    *,
	    photo.id as img,
	    ROUND(
	        6378.138 * 2 * ASIN(
	            SQRT(
	                POW(
	                    SIN(
	                        (
	                            #{0} * PI() / 180 - latitude * PI() / 180
	                        ) / 2
	                    ),
	                    2
	                ) + COS(#{0} * PI() / 180) * COS(latitude * PI() / 180) * POW(
	                    SIN(
	                        (
	                            #{1} * PI() / 180 - longitude * PI() / 180
	                        ) / 2
	                    ),
	                    2
	                )
	            )
	        ) * 1000
	    ) AS distance
	FROM
	    business,photo
	where business.id=photo.business_id
	HAVING
		distance &lt;= #{2}
	ORDER BY
	    distance ASC
	LIMIT 1,150
    </select> 
    <!-- 返回距离指定地点指定范围的restaurant -->
    <select id="getRestaurantByDistance2" resultType="com.rrs.pojo.Restaurant">
	    SELECT 
	    *,
	    photo.id as img,
	    ROUND(
	        6378.138 * 2 * ASIN(
	            SQRT(
	                POW(
	                    SIN(
	                        (
	                            #{0} * PI() / 180 - latitude * PI() / 180
	                        ) / 2
	                    ),
	                    2
	                ) + COS(#{0} * PI() / 180) * COS(latitude * PI() / 180) * POW(
	                    SIN(
	                        (
	                            #{1} * PI() / 180 - longitude * PI() / 180
	                        ) / 2
	                    ),
	                    2
	                )
	            )
	        ) * 1000
	    ) AS distance
	FROM
	    business,photo
	where business.id=photo.business_id
	HAVING
		#{2} &gt;= distance &lt;= #{3}
	ORDER BY
	    distance ASC
	LIMIT 1,150
    </select> 
    <!-- 返回距离指定地点指定范围的restaurant -->
    <select id="getRestaurantByDistance3" resultType="com.rrs.pojo.Restaurant">
	    SELECT 
	    *,
	    photo.id as img,
	    ROUND(
	        6378.138 * 2 * ASIN(
	            SQRT(
	                POW(
	                    SIN(
	                        (
	                            #{0} * PI() / 180 - latitude * PI() / 180
	                        ) / 2
	                    ),
	                    2
	                ) + COS(#{0} * PI() / 180) * COS(latitude * PI() / 180) * POW(
	                    SIN(
	                        (
	                            #{1} * PI() / 180 - longitude * PI() / 180
	                        ) / 2
	                    ),
	                    2
	                )
	            )
	        ) * 1000
	    ) AS distance
	FROM
	    business,photo
	where business.id=photo.business_id
	HAVING
		distance &gt;= #{2}
	ORDER BY
	    distance ASC
	LIMIT 1,150
    </select> 
    
    
    
    

</mapper>